---
title: 华夫饼
author: 庄闪闪
date: '2020-11-24'
slug: []
categories:
  - R可视乎
tags:
  - Rplot
subtitle: ''
summary: ''
authors: []
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<p>华夫饼图分为块状华夫饼图和点状华夫饼图。块状华夫饼图（waffle chart）是展示总数据的组类别情况的一种有效图表。华夫饼是西方的一种由小方格组成的面包，所以这种图表因此得名为华夫饼图。</p>
<p>块状华夫饼图的小方格用不同颜色表示不同类别，适合用来快速检视数据集中不同类别的分布和比例，并与其他数据集的分布和比例进行比较，让人更容易找出当中模式。块状华夫饼图主要包括侧重展示<strong>类别数值的堆积型块状华夫饼图</strong>和侧重展示<strong>类别占比的百分百堆积型块状华夫饼图</strong></p>
<pre class="r"><code>library(ggplot2)
library(RColorBrewer)  
library(reshape2)

nrows &lt;- 10
categ_table &lt;- round(table(mpg$class ) * ((nrows*nrows)/(length(mpg$class))))
sort_table&lt;-sort(categ_table,index.return=TRUE,decreasing = FALSE)
Order&lt;-sort(as.data.frame(categ_table)$Freq,index.return=TRUE,decreasing = FALSE)
df &lt;- expand.grid(y = 1:nrows, x = 1:nrows)
df$category&lt;-factor(rep(names(sort_table),sort_table), levels=names(sort_table))
Color&lt;-brewer.pal(length(sort_table), &quot;Set2&quot;)
head(df)</code></pre>
<pre><code>##   y x category
## 1 1 1  2seater
## 2 2 1  2seater
## 3 3 1  minivan
## 4 4 1  minivan
## 5 5 1  minivan
## 6 6 1  minivan</code></pre>
<pre class="r"><code>df$x</code></pre>
<pre><code>##   [1]  1  1  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  2  2  3  3  3  3  3
##  [26]  3  3  3  3  3  4  4  4  4  4  4  4  4  4  4  5  5  5  5  5  5  5  5  5  5
##  [51]  6  6  6  6  6  6  6  6  6  6  7  7  7  7  7  7  7  7  7  7  8  8  8  8  8
##  [76]  8  8  8  8  8  9  9  9  9  9  9  9  9  9  9 10 10 10 10 10 10 10 10 10 10</code></pre>
<pre class="r"><code>ggplot(df, aes(x = y, y = x, fill = category)) + 
  geom_tile(color = &quot;white&quot;, size = 0.25) +
  #geom_point(color = &quot;black&quot;,shape=1,size=5) + 
  coord_fixed(ratio = 1)+ #x,y轴尺寸固定，ratio=1表示x，y轴长度相同
  scale_x_continuous(trans = &#39;reverse&#39;) +#expand = c(0, 0),
  scale_y_continuous(trans = &#39;reverse&#39;) +#expand = c(0, 0),
  scale_fill_manual(name = &quot;Category&quot;, 
                    #labels = names(sort_table),
                    values = Color)+
  theme(#panel.border = element_rect(fill=NA,size = 2),
    panel.background  = element_blank(),
    plot.title = element_text(size = rel(1.2)),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    legend.title = element_blank(),
    legend.position = &quot;right&quot;)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>点状华夫饼图（dot matrix chart）以点为单位显示离散数据，每种颜色的点表示一个特定类别，并以矩阵形式组合在一起，适合用来快速检视数据集中不同类别的分布和比例，并与其他数据集的分布和比例进行比较，让人更容易找出当中模式。当只有一个变量/类别时（所有点都是相同颜色），点状华夫饼图相当于比例面积图</p>
<pre class="r"><code>library(ggforce)
ggplot(df, aes(x0 = y, y0 = x, fill = category,r=0.5)) + 
  geom_circle(color = &quot;black&quot;, size = 0.25) +
  #geom_point(color = &quot;black&quot;,shape=21,size=6) + 
  coord_fixed(ratio = 1)+
  scale_x_continuous(trans = &#39;reverse&#39;) +#expand = c(0, 0),
  scale_y_continuous(trans = &#39;reverse&#39;) +#expand = c(0, 0),
  scale_fill_manual(name = &quot;Category&quot;, 
                    #labels = names(sort_table),
                    values = Color)+
  theme(#panel.border = element_rect(fill=NA,size = 2),
    panel.background  = element_blank(),
    plot.title = element_text(size = rel(1.2)),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    legend.title = element_blank(),
    legend.position = &quot;right&quot;)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>堆积型</p>
<pre class="r"><code>library(dplyr)
nrows &lt;- 10
ndeep &lt;- 10
unit&lt;-100
df &lt;- expand.grid(y = 1:nrows, x = 1:nrows)

categ_table &lt;- as.data.frame(table(mpg$class) * (nrows*nrows))
colnames(categ_table)&lt;-c(&quot;names&quot;,&quot;vals&quot;)
categ_table&lt;-arrange(categ_table,desc(vals))
categ_table$vals&lt;-categ_table$vals /unit


tb4waffles &lt;- expand.grid(y = 1:ndeep,x = seq_len(ceiling(sum(categ_table$vals) / ndeep)))
regionvec &lt;- as.character(rep(categ_table$names, categ_table$vals))
tb4waffles&lt;-tb4waffles[1:length(regionvec),]

tb4waffles$names &lt;- factor(regionvec,levels=categ_table$names)

Color&lt;-brewer.pal(nrow(categ_table), &quot;Set2&quot;)</code></pre>
<pre class="r"><code>ggplot(tb4waffles, aes(x = x, y = y, fill = names)) + 
  #geom_tile(color = &quot;white&quot;) + # 
  geom_point(color = &quot;black&quot;,shape=21,size=5) + # 
  scale_fill_manual(name = &quot;Category&quot;, 
                    values = Color)+
  xlab(&quot;1 square = 100&quot;)+
  ylab(&quot;&quot;)+
  coord_fixed(ratio = 1)+
  theme(#panel.border = element_rect(fill=NA,size = 2),
         panel.background  = element_blank(),
        plot.title = element_text(size = rel(1.2)),
        #axis.text = element_blank(),
        #axis.title = element_blank(),
        #axis.ticks = element_blank(),
        # legend.title = element_blank(),
        legend.position = &quot;right&quot;)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>library(ggforce)

ggplot(tb4waffles, aes(x0 = x, y0 = y, fill = names,r=0.5)) + 
  #geom_tile(color = &quot;white&quot;) + # 
  geom_circle(color = &quot;black&quot;,size=0.25) + # 
  scale_fill_manual(name = &quot;Category&quot;, 
                    values = Color)+
  xlab(&quot;1 square = 100&quot;)+
  ylab(&quot;&quot;)+
  coord_fixed(ratio = 1)+
  theme(#panel.border = element_rect(fill=NA,size = 2),
    panel.background  = element_blank(),
    plot.title = element_text(size = rel(1.2)),
    #axis.text = element_blank(),
    #axis.title = element_blank(),
    #axis.ticks = element_blank(),
    # legend.title3 = element_blank(),
    legend.position = &quot;right&quot;)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div id="waffle-包绘制" class="section level2">
<h2>waffle 包绘制</h2>
<pre class="r"><code>library(waffle)</code></pre>
<pre><code>## Warning: 程辑包&#39;waffle&#39;是用R版本4.0.3 来建造的</code></pre>
<pre class="r"><code>savings &lt;- c(`Mortgage ($84,911)`=84911, `Auto andntuition loans ($14,414)`=14414, 
             `Home equity loans ($10,062)`=10062, `Credit Cards ($8,565)`=8565)
waffle(savings/392, rows=7, size=0.5, 
       colors=c(&quot;#c7d4b6&quot;, &quot;#a3aabd&quot;, &quot;#a0d0de&quot;, &quot;#97b5cf&quot;), 
       title=&quot;Average Household Savings Each Year&quot;, 
       xlab=&quot;1 square == $392&quot;)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>parts &lt;- c(One=80, Two=30, Three=20, Four=10)
chart &lt;- waffle(parts, rows=8,
  colors=c(&quot;#c7d4b6&quot;, &quot;#a3aabd&quot;, &quot;#a0d0de&quot;, &quot;#97b5cf&quot;),
  title=&quot;庄闪闪的成长手册&quot;)
print(chart)</code></pre>
<p><img src="/post/2020-11-24-华夫饼/index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
